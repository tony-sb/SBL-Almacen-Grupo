CREATE DATABASE almacen_beneficencia2;
USE almacen_beneficencia2;

CREATE TABLE roles (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
nombre VARCHAR(50) UNIQUE NOT NULL,
descripcion VARCHAR(255)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE usuarios (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
username VARCHAR(50) UNIQUE NOT NULL,
password VARCHAR(255) NOT NULL,
nombre VARCHAR(100) NOT NULL,
apellido VARCHAR(100) NOT NULL,
email VARCHAR(100),
enabled BOOLEAN DEFAULT TRUE,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
INDEX idx_usuario_username (username),
INDEX idx_usuario_nombre (nombre, apellido)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE usuarios_roles (
usuario_id BIGINT NOT NULL,
rol_id BIGINT NOT NULL,
PRIMARY KEY (usuario_id, rol_id),
FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE,
FOREIGN KEY (rol_id) REFERENCES roles(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE categorias (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
nombre VARCHAR(100) NOT NULL,
descripcion TEXT,
INDEX idx_categoria_nombre (nombre)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE productos (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
codigo VARCHAR(50) UNIQUE NOT NULL,
nombre VARCHAR(255) NOT NULL,
descripcion TEXT,
cantidad INT NOT NULL DEFAULT 0,
unidad_medida VARCHAR(20) NOT NULL,
stock_minimo INT NOT NULL DEFAULT 10,
categoria_id BIGINT,
precio_unitario DECIMAL(10,2) DEFAULT 0.00,
fecha_vencimiento DATE,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
categoria VARCHAR(255) NOT NULL,
FOREIGN KEY (categoria_id) REFERENCES categorias(id) ON DELETE SET NULL,
INDEX idx_producto_codigo (codigo),
INDEX idx_producto_nombre (nombre),
INDEX idx_producto_categoria (categoria),
INDEX idx_producto_stock (cantidad),
INDEX idx_producto_vencimiento (fecha_vencimiento)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE beneficiarios (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
dni VARCHAR(8) UNIQUE NOT NULL,
nombres VARCHAR(100) NOT NULL,
apellidos VARCHAR(100) NOT NULL,
telefono VARCHAR(15),
direccion VARCHAR(500),
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
INDEX idx_beneficiario_dni (dni),
INDEX idx_beneficiario_nombre (nombres, apellidos),
INDEX idx_beneficiario_telefono (telefono)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE ordenes_salida (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
numero_orden_salida VARCHAR(50) UNIQUE NOT NULL,
numero_orden VARCHAR(50) UNIQUE NOT NULL,
fecha_salida DATE NOT NULL,
dni_usuario VARCHAR(8) NOT NULL,
nombre_usuario VARCHAR(255) NOT NULL,
beneficiario_id BIGINT,
numero_tramite VARCHAR(100) NOT NULL,
cantidad_productos INT NOT NULL DEFAULT 0,
descripcion VARCHAR(255),
usuario_id BIGINT NOT NULL,
estado VARCHAR(20) DEFAULT 'COMPLETADA',
observaciones TEXT,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (beneficiario_id) REFERENCES beneficiarios(id) ON DELETE SET NULL,
FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
INDEX idx_os_numero (numero_orden),
INDEX idx_os_fecha (fecha_salida),
INDEX idx_os_dni (dni_usuario),
INDEX idx_os_tramite (numero_tramite),
INDEX idx_os_usuario (usuario_id),
INDEX idx_os_estado (estado)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE orden_salida_items (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
orden_salida_id BIGINT NOT NULL,
producto_id BIGINT NOT NULL,
cantidad INT NOT NULL,
precio_unitario DECIMAL(10,2) DEFAULT 0.00,
subtotal DECIMAL(10,2) DEFAULT 0.00,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (orden_salida_id) REFERENCES ordenes_salida(id) ON DELETE CASCADE,
FOREIGN KEY (producto_id) REFERENCES productos(id),
INDEX idx_osi_orden (orden_salida_id),
INDEX idx_osi_producto (producto_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE movimientos_inventario (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
producto_id BIGINT NOT NULL,
tipo_movimiento ENUM('ENTRADA', 'SALIDA') NOT NULL,
cantidad INT NOT NULL,
motivo VARCHAR(255) NOT NULL,
usuario_id BIGINT NOT NULL,
orden_salida_id BIGINT,
fecha_movimiento TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
observaciones TEXT,
FOREIGN KEY (producto_id) REFERENCES productos(id),
FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
FOREIGN KEY (orden_salida_id) REFERENCES ordenes_salida(id) ON DELETE SET NULL,
INDEX idx_movimiento_fecha (fecha_movimiento),
INDEX idx_movimiento_producto (producto_id, tipo_movimiento),
INDEX idx_movimiento_orden (orden_salida_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE movimientos_recientes (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
producto_id BIGINT NOT NULL,
fecha_salida DATE NOT NULL,
cantidad INT NOT NULL,
dni_beneficiario VARCHAR(255),
FOREIGN KEY (producto_id) REFERENCES productos(id),
INDEX idx_mr_fecha (fecha_salida),
INDEX idx_mr_producto (producto_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE proveedores (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
ruc VARCHAR(20) UNIQUE NOT NULL,
nombre VARCHAR(255) NOT NULL,
direccion TEXT,
telefono VARCHAR(20),
email VARCHAR(100),
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
INDEX idx_proveedor_ruc (ruc),
INDEX idx_proveedor_nombre (nombre)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


CREATE TABLE ordenes_abastecimiento (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
numero_oa VARCHAR(50) UNIQUE NOT NULL,
fecha_oa DATE NOT NULL,
proveedor_id BIGINT NOT NULL,
usuario_id BIGINT NOT NULL,
tipo_orden ENUM('ALIMENTOS', 'U_OFICINA','R_UTILES', 'OTROS') NOT NULL,
estado ENUM('PENDIENTE', 'APROBADA', 'RECHAZADA', 'COMPLETADA') DEFAULT 'PENDIENTE',
total DECIMAL(10,2) DEFAULT 0.00,
observaciones TEXT,
fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (proveedor_id) REFERENCES proveedores(id),
FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
INDEX idx_oa_numero (numero_oa),
INDEX idx_oa_fecha (fecha_oa),
INDEX idx_oa_estado (estado),
INDEX idx_oa_tipo (tipo_orden)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE orden_abastecimiento_items (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
orden_abastecimiento_id BIGINT NOT NULL,
producto_id BIGINT NOT NULL,
cantidad INT NOT NULL,
precio_unitario DECIMAL(10,2) NOT NULL,
subtotal DECIMAL(10,2) NOT NULL,
FOREIGN KEY (orden_abastecimiento_id) REFERENCES ordenes_abastecimiento(id) ON DELETE CASCADE,
FOREIGN KEY (producto_id) REFERENCES productos(id),
INDEX idx_oai_orden (orden_abastecimiento_id),
INDEX idx_oai_producto (producto_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE cuadre_inventario (
id BIGINT AUTO_INCREMENT PRIMARY KEY,
producto_id BIGINT NOT NULL,
cantidad INT NOT NULL,
fecha_vencimiento DATE,
observaciones TEXT,
accion VARCHAR(255) NOT NULL,
estado VARCHAR(255) NOT NULL DEFAULT 'PENDIENTE',
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_confirmacion TIMESTAMP NULL,
FOREIGN KEY (producto_id) REFERENCES productos(id) ON DELETE CASCADE,
INDEX idx_cuadre_estado (estado),
INDEX idx_cuadre_producto (producto_id),
INDEX idx_cuadre_fecha (fecha_registro)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

INSERT INTO roles (nombre, descripcion) VALUES
('ADMIN', 'Administrador del sistema con todos los permisos'),
('ALMACENERO', 'Usuario encargado del almacén'),
('USUARIO', 'Usuario básico del sistema');

INSERT INTO usuarios (username, password, nombre, apellido, email) VALUES
('admin', '$2a$10$/8an.EbbuR906ZCiXO6AI.GN9cKnKCZ1jRimVgKch7JxHhJy4v0/K', 'Juan', 'Pérez', 'admin@beneficencia.com'),
('almacenero', '$2a$10$/8an.EbbuR906ZCiXO6AI.GN9cKnKCZ1jRimVgKch7JxHhJy4v0/K', 'María', 'García', 'almacen@beneficencia.com'),
('usuario', '$2a$10$/8an.EbbuR906ZCiXO6AI.GN9cKnKCZ1jRimVgKch7JxHhJy4v0/K', 'Carlos', 'López', 'usuario@beneficencia.com');

INSERT INTO usuarios_roles (usuario_id, rol_id) VALUES
(1, 1),
(2, 2),
(3, 3);

INSERT INTO categorias (nombre, descripcion) VALUES
('Medicamentos', 'Medicamentos y fármacos para tratamiento'),
('Insumos Médicos', 'Material médico quirúrgico y equipos'),
('Limpieza', 'Productos de limpieza y aseo'),
('Alimentos', 'Alimentos y bebidas para pacientes'),
('Material Oficina', 'Material de oficina y papelería');

INSERT INTO beneficiarios (dni, nombres, apellidos, telefono, direccion) VALUES
('12345678', 'Ana María', 'González Pérez', '987654321', 'Av. Libertad 123'),
('87654321', 'Luis Carlos', 'Rodríguez López', '912345678', 'Jr. Unión 456'),
('23456789', 'María Elena', 'Fernández García', '923456789', 'Calle Lima 789'),
('34567890', 'Carlos Alberto', 'Martínez Sánchez', '934567890', 'Av. Central 101'),
('45678901', 'Sofía Isabel', 'Torres Castro', '945678901', 'Jr. San Martín 202'),
('56789012', 'Pedro José', 'Díaz Romero', '956789012', 'Calle Bolívar 303'),
('67890123', 'Carmen Rosa', 'Ruiz Vargas', '967890123', 'Av. Ejército 404'),
('78901234', 'Javier Andrés', 'Gómez Mendoza', '978901234', 'Jr. Tacna 505');

INSERT INTO productos (codigo, nombre, descripcion, cantidad, unidad_medida, stock_minimo, categoria_id, categoria, precio_unitario) VALUES
('MED-001', 'Paracetamol 500mg', 'Analgésico y antipirético', 150, 'Tabletas', 50, 1, 'Medicamentos', 0.50),
('MED-002', 'Amoxicilina 250mg', 'Antibiótico de amplio espectro', 80, 'Cápsulas', 30, 1, 'Medicamentos', 1.20),
('MED-003', 'Ibuprofeno 400mg', 'Antiinflamatorio no esteroideo', 120, 'Tabletas', 40, 1, 'Medicamentos', 0.80),
('MED-004', 'Omeprazol 20mg', 'Protector gástrico', 90, 'Cápsulas', 25, 1, 'Medicamentos', 1.50),
('MED-005', 'Aumentín 625 Duo', 'Antibiótico combinado', 60, 'Tabletas', 20, 1, 'Medicamentos', 2.50),
('INS-001', 'Jeringa 3ml', 'Jeringa desechable estéril', 200, 'Unidades', 100, 2, 'Insumos Médicos', 0.25),
('INS-002', 'Guantes Latex M', 'Guantes desechables', 500, 'Pares', 200, 2, 'Insumos Médicos', 0.15),
('INS-003', 'Mascarilla Quirúrgica', 'Mascarilla desechable', 300, 'Unidades', 150, 2, 'Insumos Médicos', 0.10),
('INS-004', 'Termómetro Digital', 'Termómetro clínico', 15, 'Unidades', 5, 2, 'Insumos Médicos', 25.00),
('INS-005', 'Gasas Estériles', 'Gasas 10x10cm', 120, 'Paquetes', 50, 2, 'Insumos Médicos', 0.30),
('LIM-001', 'Jabón Líquido', 'Jabón antibacterial', 25, 'Litros', 10, 3, 'Limpieza', 8.50),
('LIM-002', 'Alcohol en Gel', 'Gel antibacterial 500ml', 40, 'Frasco', 15, 3, 'Limpieza', 12.00),
('LIM-003', 'Cloro', 'Cloro líquido 1L', 30, 'Botella', 10, 3, 'Limpieza', 5.50),
('LIM-004', 'Detergente', 'Detergente líquido', 35, 'Litros', 12, 3, 'Limpieza', 7.80),
('ALI-001', 'Leche en Polvo', 'Leche fortificada', 30, 'Kg', 15, 4, 'Alimentos', 12.00),
('ALI-002', 'Arroz', 'Arroz extra', 50, 'Kg', 20, 4, 'Alimentos', 4.50),
('ALI-003', 'Aceite Vegetal', 'Aceite 1L', 40, 'Botella', 15, 4, 'Alimentos', 8.00),
('ALI-004', 'Azúcar', 'Azúcar blanca', 45, 'Kg', 18, 4, 'Alimentos', 3.20),
('OFI-001', 'Resma Papel A4', 'Papel bond 75gr', 20, 'Resma', 5, 5, 'Material Oficina', 25.00),
('OFI-002', 'Bolígrafos', 'Bolígrafos azules', 100, 'Unidades', 30, 5, 'Material Oficina', 1.20),
('OFI-003', 'Carpetas', 'Carpetas oficio', 50, 'Unidades', 15, 5, 'Material Oficina', 3.50),
('OFI-004', 'Cinta Adhesiva', 'Cinta transparente', 30, 'Rollos', 10, 5, 'Material Oficina', 2.80);

INSERT INTO proveedores (ruc, nombre, direccion, telefono, email) VALUES
('20123456789', 'Farmacia Central S.A.', 'Av. Libertad 123', '074-123456', 'ventas@farmaciacentral.com'),
('20123456788', 'Distribuidora Médica Norte', 'Calle Los Pinos 456', '074-654321', 'contacto@medicanorte.com'),
('20123456787', 'Laboratorios Pharma Perú', 'Jr. Unión 789', '074-789123', 'info@pharmaperu.com'),
('20123456786', 'Alimentos Nutri S.A.', 'Av. Industrial 101', '074-456789', 'ventas@nutri.com'),
('20123456785', 'Limpieza Total EIRL', 'Calle Comercio 202', '074-321654', 'info@limpiezatotal.com');

INSERT INTO ordenes_abastecimiento (numero_oa, fecha_oa, proveedor_id, usuario_id, tipo_orden, estado, total) VALUES
('UOF-2025-001', '2025-01-15', 5, 1, 'U_OFICINA', 'PENDIENTE', 800.50);

INSERT INTO ordenes_salida (numero_orden_salida, numero_orden, fecha_salida, dni_usuario, nombre_usuario, beneficiario_id, numero_tramite, cantidad_productos, descripcion, usuario_id, estado) VALUES
('OS-2025-01-0001', 'OS-0001-2025', '2025-01-15', '12345678', 'Ana María González Pérez', 1, 'TRAM-2025-001', 5, 'Medicamentos para tratamiento', 2, 'COMPLETADA'),
('OS-2025-01-0002', 'OS-0002-2025', '2025-01-16', '87654321', 'Luis Carlos Rodríguez López', 2, 'TRAM-2025-002', 8, 'Insumos médicos', 2, 'COMPLETADA'),
('OS-2025-01-0003', 'OS-0003-2025', '2025-01-17', '23456789', 'María Elena Fernández García', 3, 'TRAM-2025-003', 12, 'Alimentos para paciente', 2, 'COMPLETADA'),
('OS-2025-01-0004', 'OS-0004-2025', '2025-01-18', '34567890', 'Carlos Alberto Martínez Sánchez', 4, 'TRAM-2025-004', 6, 'Productos de limpieza', 2, 'COMPLETADA'),
('OS-2025-01-0005', 'OS-0005-2025', '2025-01-19', '45678901', 'Sofía Isabel Torres Castro', 5, 'TRAM-2025-005', 10, 'Entrega mensual', 2, 'COMPLETADA');

INSERT INTO orden_salida_items (orden_salida_id, producto_id, cantidad, precio_unitario, subtotal) VALUES
(1, 1, 2, 0.50, 1.00),
(1, 2, 3, 1.20, 3.60),
(2, 6, 5, 0.25, 1.25),
(2, 7, 3, 0.15, 0.45),
(3, 16, 8, 12.00, 96.00),
(3, 17, 4, 4.50, 18.00),
(4, 11, 3, 8.50, 25.50),
(4, 12, 3, 12.00, 36.00),
(5, 3, 5, 0.80, 4.00),
(5, 4, 5, 1.50, 7.50);

INSERT INTO movimientos_inventario (producto_id, tipo_movimiento, cantidad, motivo, usuario_id, orden_salida_id) VALUES
(1, 'SALIDA', 2, 'Orden OS-0001-2025', 2, 1),
(2, 'SALIDA', 3, 'Orden OS-0001-2025', 2, 1),
(6, 'SALIDA', 5, 'Orden OS-0002-2025', 2, 2),
(7, 'SALIDA', 3, 'Orden OS-0002-2025', 2, 2),
(16, 'SALIDA', 8, 'Orden OS-0003-2025', 2, 3),
(17, 'SALIDA', 4, 'Orden OS-0003-2025', 2, 3),
(11, 'SALIDA', 3, 'Orden OS-0004-2025', 2, 4),
(12, 'SALIDA', 3, 'Orden OS-0004-2025', 2, 4),
(3, 'SALIDA', 5, 'Orden OS-0005-2025', 2, 5),
(4, 'SALIDA', 5, 'Orden OS-0005-2025', 2, 5);

INSERT INTO movimientos_recientes (producto_id, fecha_salida, cantidad, dni_beneficiario) VALUES
(1, '2025-01-15', 2, '12345678'),
(2, '2025-01-15', 3, '12345678'),
(6, '2025-01-16', 5, '87654321'),
(7, '2025-01-16', 3, '87654321'),
(16, '2025-01-17', 8, '23456789'),
(17, '2025-01-17', 4, '23456789');


SELECT * FROM ordenes_salida;
SELECT * FROM orden_salida_items;

----------------------------------


SELECT * FROM ordenes_salida;
SELECT * FROM orden_salida_items;
SELECT * FROM proveedores;

-- Actualizar la columna texto desde la tabla categorias
UPDATE productos p
JOIN categorias c ON p.categoria_id = c.id
SET p.categoria = c.nombre
WHERE p.categoria IS NULL OR p.categoria = '';

SELECT id, codigo, nombre, fecha_vencimiento
FROM productos
ORDER BY id DESC
LIMIT 5;
USE almacen_beneficencia2;
USE almacen_beneficencia2;

-- Actualizar fechas de vencimiento para productos existentes
UPDATE productos SET fecha_vencimiento = '2026-06-15' WHERE codigo = 'MED-001';
UPDATE productos SET fecha_vencimiento = '2025-12-31' WHERE codigo = 'MED-002';
UPDATE productos SET fecha_vencimiento = '2026-03-20' WHERE codigo = 'MED-003';
UPDATE productos SET fecha_vencimiento = '2025-11-30' WHERE codigo = 'MED-004';
UPDATE productos SET fecha_vencimiento = '2025-12-10' WHERE codigo = 'MED-005';

UPDATE productos SET fecha_vencimiento = '2027-01-01' WHERE codigo = 'INS-001';
UPDATE productos SET fecha_vencimiento = '2026-08-15' WHERE codigo = 'INS-002';
UPDATE productos SET fecha_vencimiento = '2026-08-15'  WHERE codigo = 'INS-003';
UPDATE productos SET fecha_vencimiento = '2028-12-31' WHERE codigo = 'INS-004';
UPDATE productos SET fecha_vencimiento = '2026-04-10' WHERE codigo = 'INS-005';

UPDATE productos SET fecha_vencimiento = '2027-06-30' WHERE codigo = 'LIM-001';
UPDATE productos SET fecha_vencimiento = '2025-12-25' WHERE codigo = 'LIM-002';
UPDATE productos SET fecha_vencimiento = '2026-08-15'  WHERE codigo = 'LIM-003';
UPDATE productos SET fecha_vencimiento = '2026-11-15' WHERE codigo = 'LIM-004';

UPDATE productos SET fecha_vencimiento = '2025-12-05' WHERE codigo = 'ALI-001';
UPDATE productos SET fecha_vencimiento = '2027-08-01' WHERE codigo = 'ALI-002';
UPDATE productos SET fecha_vencimiento = '2025-11-20' WHERE codigo = 'ALI-003';
UPDATE productos SET fecha_vencimiento = '2028-01-01' WHERE codigo = 'ALI-004';

-- Material de oficina generalmente no tiene fecha
UPDATE productos SET fecha_vencimiento = NULL WHERE codigo = 'OFI-001';
UPDATE productos SET fecha_vencimiento = NULL WHERE codigo = 'OFI-002';
UPDATE productos SET fecha_vencimiento = NULL WHERE codigo = 'OFI-003';
UPDATE productos SET fecha_vencimiento = NULL WHERE codigo = 'OFI-004';
SELECT * FROM productos;

-- Agregar esta tabla a tu script de base de datos
CREATE TABLE movimientos_salida (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    cantidad INT NOT NULL,
    descripcion VARCHAR(255),
    dni_beneficiario VARCHAR(8),
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_salida DATE NOT NULL,
    nombre_beneficiario VARCHAR(255),
    numero_tramite VARCHAR(100),
    producto_id BIGINT NOT NULL,
    usuario_id BIGINT NOT NULL,
    FOREIGN KEY (producto_id) REFERENCES productos(id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    INDEX idx_ms_fecha_salida (fecha_salida),
    INDEX idx_ms_producto (producto_id),
    INDEX idx_ms_dni (dni_beneficiario)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


//-- Trigger para registrar movimientos de salida automáticamente
CREATE TRIGGER after_orden_salida_item_insert
AFTER INSERT ON orden_salida_items
FOR EACH ROW
BEGIN
    INSERT INTO movimientos_salida (
        cantidad,
        descripcion,
        dni_beneficiario,
        fecha_salida,
        nombre_beneficiario,
        numero_tramite,
        producto_id,
        usuario_id
    )
    SELECT
        NEW.cantidad,
        os.descripcion,
        os.dni_usuario,
        os.fecha_salida,
        os.nombre_usuario,
        os.numero_tramite,
        NEW.producto_id,
        os.usuario_id
    FROM ordenes_salida os
    WHERE os.id = NEW.orden_salida_id;
END$$

DELIMITER ;